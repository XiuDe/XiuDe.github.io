---
layout: original
title: 关于ajax
date: 2017-10-19 21:19:49 +0800 
categories: 前端框架研究
tag: ajax
---
* content
{:toc}

框架的ajax用多了，敲原生ajax出错了，整合一下。

<!-- more -->

## iframe隐藏帧实现页面局部更新
- 在浏览器兼容ajax之前的技术
- iframe就相当于页面的子页面
- 不是异步请求

```
// 登录页面
    <div>
        <form action="./iframe.php" method="post" target="myframe">
            用户名：<input type="text" name="username"><span id="info"></span><br>
            密码：<input type="text" name="password">
            <input type="submit" value="登录">
        </form>
    </div>
    <iframe width="0" height="0"  frameborder="0" name="myframe"></iframe>


// 后台
<?php 
$uname = $_POST['username'];
$pw = $_POST['password'];

// if($uname == 'admin' && $pw == '123'){
//     echo '登录成功';
// }


if($uname == 'admin' && $pw == '123'){
?>
    <script type="text/javascript">
        // parent子页面的父页面
        parent.document.getElementById('info').innerHTML = '登录成功';
    </script>
<?php }else{ ?>
    <script type="text/javascript">
        parent.document.getElementById('info').innerHTML = '登录失败';
    </script>
<?php } ?>    
```

## 原生ajax

```
        var btn = document.getElementById('btn');
        btn.onclick = function(){
            var uname = document.getElementById('username').value;
            var pw = document.getElementById('password').value;

            // 使用Ajax发送请求：
            // 1、创建XMLHttpRequest对象
            var xhr = null;
            if(window.XMLHttpRequest){
                xhr = new XMLHttpRequest();//标准
            }else{
                xhr = new ActiveXObject("Microsoft");//IE6
            }
            // readyState=0表示xhr对象创建完成
            console.log(xhr.readyState + '----------1-----------');//0


            // 2、准备发送
            /*
            参数一：请求方式（get获取数据；post提交数据）
            参数二：请求地址
            参数三：同步或者异步标志位，默认是true表示异步，false表示同步
                    false的应用场景很少见。

            如果是get请求那么请求参数必须在url中传递
            encodeURI()用来对中文参数进行编码，防止乱码，
            IE中极易出现乱码

            post请求参数通过send传递，不需要通过encodeURI()转码
            必须设置请求头信息
            xhr.open('post','04post.php',true);
            xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            xhr.send(param);//post请求参数在这里传递，并且不需要转码
            */
            var param = 'username='+uname+'&password='+pw;
            xhr.open('get','03get.php?'+encodeURI(param),true);
            
            // 3、执行发送动作
            xhr.send(null);
            // readyState=1表示已经发送了请求
            console.log(xhr.readyState + '----------2-----------');//1
            // 该函数调用的条件就是readyState状态发生变化（不包括从0变为1）

            // 4、指定回调函数
            xhr.onreadystatechange = function(){
                /*
                readyState:
                2 浏览器已经收到了服务器响应的数据
                3 正在解析数据
                4 数据已经解析完成，可以使用了
                */
                console.log(xhr.readyState + '----------3-----------');// 2 3 4
                // 4表示服务器返回的数据已经可以使用了，但是这个数据不一定是正常的
                if(xhr.readyState == 4){
                    if(xhr.status == 200){
                    // http的常见状态码
                    /*
                    200表示响应成功
                    404没有找到请求的资源
                    500服务器端错误
                    */
                    // 200表示服务器返回的数据是正常的，不是200的话表示数据是错误的
                        var data = xhr.responseText;
                        var info = document.getElementById('info');
                        if(data == '1'){
                            info.innerHTML = '登录成功';
                        }else if(data == '2'){
                            info.innerHTML = '用户名或者密码错误';
                        }
                    }
                }
            }
        }
```
